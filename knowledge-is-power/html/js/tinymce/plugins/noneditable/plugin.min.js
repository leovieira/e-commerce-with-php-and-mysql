tinymce.PluginManager.add("noneditable",function(e){function t(){function t(e){var t;if(1===e.nodeType){if((t=e.getAttribute(l))&&"inherit"!==t)return t;if("inherit"!==(t=e.contentEditable))return t}return null}function n(e){for(var n;e;){if(n=t(e))return"false"===n?e:null;e=e.parentNode}}function r(e){for(;e;){if(e.id===m)return e;e=e.parentNode}}function a(e){var t;if(e)for(t=new o(e,e),e=t.current();e;e=t.next())if(3===e.nodeType)return e}function i(n,r){var a,i;return"false"===t(n)&&s.isBlock(n)?void g.select(n):(i=s.createRng(),"true"===t(n)&&(n.firstChild||n.appendChild(e.getDoc().createTextNode("Â ")),n=n.firstChild,r=!0),a=s.create("span",{id:m,"data-mce-bogus":!0},v),r?n.parentNode.insertBefore(a,n):s.insertAfter(a,n),i.setStart(a.firstChild,1),i.collapse(!0),g.setRng(i),a)}function d(e){var t,n,i,o;if(e)t=g.getRng(!0),t.setStartBefore(e),t.setEndBefore(e),n=a(e),n&&n.nodeValue.charAt(0)==v&&(n=n.deleteData(0,1)),s.remove(e,!0),g.setRng(t);else for(i=r(g.getStart());(e=s.get(m))&&e!==o;)i!==e&&(n=a(e),n&&n.nodeValue.charAt(0)==v&&(n=n.deleteData(0,1)),s.remove(e,!0)),o=e}function u(){function e(e,n){var r,a,i,l,d;if(r=f.startContainer,a=f.startOffset,3==r.nodeType){if(d=r.nodeValue.length,a>0&&a<d||(n?a==d:0===a))return}else{if(!(a<r.childNodes.length))return n?null:e;var u=!n&&a>0?a-1:a;r=r.childNodes[u],r.hasChildNodes()&&(r=r.firstChild)}for(i=new o(r,e);l=i[n?"prev":"next"]();){if(3===l.nodeType&&l.nodeValue.length>0)return;if("true"===t(l))return l}return e}var r,a,l,f,u;d(),l=g.isCollapsed(),r=n(g.getStart()),a=n(g.getEnd()),(r||a)&&(f=g.getRng(!0),l?(r=r||a,(u=e(r,!0))?i(u,!0):(u=e(r,!1))?i(u,!1):g.select(r)):(f=g.getRng(!0),r&&f.setStartBefore(r),a&&f.setEndAfter(a),g.setRng(f)))}function c(a){function i(e,t){for(;e=e[t?"previousSibling":"nextSibling"];)if(3!==e.nodeType||e.nodeValue.length>0)return e}function l(e,t){g.select(e),g.collapse(t)}var c,m,v,p,E=a.keyCode;if(v=g.getStart(),p=g.getEnd(),(c=n(v)||n(p))&&(E<112||E>124)&&E!=f.DELETE&&E!=f.BACKSPACE){if((tinymce.isMac?a.metaKey:a.ctrlKey)&&(67==E||88==E||86==E))return;if(a.preventDefault(),E==f.LEFT||E==f.RIGHT){var h=E==f.LEFT;if(e.dom.isBlock(c)){var y=h?c.previousSibling:c.nextSibling,b=new o(y,y);l(h?b.prev():b.next(),!h)}else l(c,h)}}else if(E==f.LEFT||E==f.RIGHT||E==f.BACKSPACE||E==f.DELETE){if(m=r(v)){if(E==f.LEFT||E==f.BACKSPACE)if((c=i(m,!0))&&"false"===t(c)){if(a.preventDefault(),E!=f.LEFT)return void s.remove(c);l(c,!0)}else d(m);if(E==f.RIGHT||E==f.DELETE)if((c=i(m))&&"false"===t(c)){if(a.preventDefault(),E!=f.RIGHT)return void s.remove(c);l(c,!1)}else d(m)}if((E==f.BACKSPACE||E==f.DELETE)&&!function(a){function i(e){for(var t=l;t;){if(t===e)return;t=t.parentNode}s.remove(e),u()}var o,l,f,d;if(g.isCollapsed()){if(o=g.getRng(!0),l=o.startContainer,f=o.startOffset,l=r(l)||l,d=n(l))return i(d),!1;if(3==l.nodeType&&(a?f>0:f<l.nodeValue.length))return!0;if(1==l.nodeType&&(l=l.childNodes[f]||l),function(){var r,o,f=e.schema.getNonEmptyElements();for(o=new tinymce.dom.TreeWalker(l,e.getBody());(r=a?o.prev():o.next())&&!f[r.nodeName.toLowerCase()]&&!(3===r.nodeType&&tinymce.trim(r.nodeValue).length>0);)if("false"===t(r))return i(r),!0;return!!n(r)}())return!1}return!0}(E==f.BACKSPACE))return a.preventDefault(),!1}}var s=e.dom,g=e.selection,m="mce_noneditablecaret",v="\ufeff";e.on("mousedown",function(n){var r=e.selection.getNode();"false"===t(r)&&r==n.target&&u()}),e.on("mouseup keyup",u),e.on("keydown",c)}function n(t){var n=i.length,r=t.content,o=tinymce.trim(a);if("raw"!=t.format){for(;n--;)r=r.replace(i[n],function(t){var n=arguments,a=n[n.length-2];return a>0&&'"'==r.charAt(a-1)?t:'<span class="'+o+'" data-mce-content="'+e.dom.encode(n[0])+'">'+e.dom.encode("string"==typeof n[1]?n[1]:n[0])+"</span>"});t.content=r}}var r,a,i,o=tinymce.dom.TreeWalker,l="data-mce-contenteditable",f=tinymce.util.VK;r=" "+tinymce.trim(e.getParam("noneditable_editable_class","mceEditable"))+" ",a=" "+tinymce.trim(e.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",i=e.getParam("noneditable_regexp"),i&&!i.length&&(i=[i]),e.on("PreInit",function(){t(),i&&e.on("BeforeSetContent",n),e.parser.addAttributeFilter("class",function(e){for(var t,n,i=e.length;i--;)n=e[i],t=" "+n.attr("class")+" ",-1!==t.indexOf(r)?n.attr(l,"true"):-1!==t.indexOf(a)&&n.attr(l,"false")}),e.serializer.addAttributeFilter(l,function(e){for(var t,n=e.length;n--;)t=e[n],i&&t.attr("data-mce-content")?(t.name="#text",t.type=3,t.raw=!0,t.value=t.attr("data-mce-content")):(t.attr("contenteditable",null),t.attr(l,null))}),e.parser.addAttributeFilter("contenteditable",function(e){for(var t,n=e.length;n--;)t=e[n],t.attr(l,t.attr("contenteditable")),t.attr("contenteditable",null)})})});