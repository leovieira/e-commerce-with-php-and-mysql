!function(){function e(e,t,n,r,a){function i(e,t){if(t=t||0,!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";var n=e.index;if(t>0){var r=e[t];if(!r)throw"Invalid capture group";n+=e[0].indexOf(r),e[0]=r}return[n,n+e[0].length,[e[0]]]}function d(e){var t;if(3===e.nodeType)return e.data;if(u[e.nodeName])return"";if(t="",(s[e.nodeName]||f[e.nodeName])&&(t+="\n"),e=e.firstChild)do{t+=d(e)}while(e=e.nextSibling);return t}var o,l,c,s,u,f,h=[],p=0;if(c=t.ownerDocument,s=a.getBlockElements(),u=a.getWhiteSpaceElements(),f=a.getShortEndedElements(),l=d(t)){if(e.global)for(;o=e.exec(l);)h.push(i(o,r));else o=l.match(e),h.push(i(o,r));return h.length&&(p=h.length,function(e,t,n){var r,a,i,d,o=[],l=0,c=e,h=t.shift(),p=0;e:for(;;){if((s[c.nodeName]||f[c.nodeName])&&l++,3===c.nodeType&&(!a&&c.length+l>=h[1]?(a=c,d=h[1]-l):r&&o.push(c),!r&&c.length+l>h[0]&&(r=c,i=h[0]-l),l+=c.length),r&&a){if(c=n({startNode:r,startNodeIndex:i,endNode:a,endNodeIndex:d,innerNodes:o,match:h[2],matchIndex:p}),l-=a.length-d,r=null,a=null,o=[],h=t.shift(),p++,!h)break}else{if(!u[c.nodeName]&&c.firstChild){c=c.firstChild;continue}if(c.nextSibling){c=c.nextSibling;continue}}for(;;){if(c.nextSibling){c=c.nextSibling;break}if(c.parentNode===e)break e;c=c.parentNode}}}(t,h,function(e){var t;if("function"!=typeof e){var n=e.nodeType?e:c.createElement(e);t=function(e,t){var r=n.cloneNode(!1);return r.setAttribute("data-mce-index",t),e&&r.appendChild(c.createTextNode(e)),r}}else t=e;return function(e){var n,r,a,i=e.startNode,d=e.endNode,o=e.matchIndex;if(i===d){var l=i;a=l.parentNode,e.startNodeIndex>0&&(n=c.createTextNode(l.data.substring(0,e.startNodeIndex)),a.insertBefore(n,l));var s=t(e.match[0],o);return a.insertBefore(s,l),e.endNodeIndex<l.length&&(r=c.createTextNode(l.data.substring(e.endNodeIndex)),a.insertBefore(r,l)),l.parentNode.removeChild(l),s}n=c.createTextNode(i.data.substring(0,e.startNodeIndex)),r=c.createTextNode(d.data.substring(e.endNodeIndex));for(var u=t(i.data.substring(e.startNodeIndex),o),f=[],h=0,p=e.innerNodes.length;h<p;++h){var g=e.innerNodes[h],m=t(g.data,o);g.parentNode.replaceChild(m,g),f.push(m)}var x=t(d.data.substring(0,e.endNodeIndex),o);return a=i.parentNode,a.insertBefore(n,i),a.insertBefore(u,i),a.removeChild(i),a=d.parentNode,a.insertBefore(x,d),a.insertBefore(r,d),a.removeChild(d),x}}(n))),p}}function t(t){function n(){var e=tinymce.ui.Factory.create({type:"window",layout:"flex",pack:"center",align:"center",onClose:function(){t.focus(),d=!1,o.unmarkAllMatches()},buttons:[{text:"Find",onclick:function(){e.find("form")[0].submit()}},{text:"Replace",disabled:!0,onclick:function(){o.replace(e.find("#replace").value())||e.statusbar.items().slice(1).disabled(!0)}},{text:"Replace all",disabled:!0,onclick:function(){o.replaceAll(e.find("#replace").value()),e.statusbar.items().slice(1).disabled(!0)}},{type:"spacer",flex:1},{text:"Prev",disabled:!0,onclick:function(){o.prev()}},{text:"Next",disabled:!0,onclick:function(){o.next()}}],title:"Find and replace",items:{type:"form",padding:20,labelGap:30,spacing:10,onsubmit:function(t){var n,r,a,i,d;if(t.preventDefault(),a=e.find("#case").checked(),d=e.find("#words").checked(),i=e.find("#find").value(),!i.length)return o.unmarkAllMatches(),void e.statusbar.items().slice(1).disabled(!0);i=i.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),i=d?"\\b"+i+"\\b":i,r=new RegExp(i,a?"g":"gi"),n=o.markAllMatches(r),n?o.first():tinymce.ui.MessageBox.alert("Could not find the specified string."),e.statusbar.items().slice(1).disabled(0===n)},items:[{type:"textbox",name:"find",size:40,label:"Find",value:t.selection.getNode().src},{type:"textbox",name:"replace",size:40,label:"Replace with"},{type:"checkbox",name:"case",text:"Match case",label:" "},{type:"checkbox",name:"words",text:"Whole words",label:" "}]}}).renderTo().reflow();d=!0}function r(e){e.parentNode.insertBefore(e.firstChild,e),e.parentNode.removeChild(e)}function a(e,n){var r,a,i=t.selection,d=i.getRng(!0),o=-1;return e=!1!==e,function(){var i,l;for(i=n?t.getBody()[e?"firstChild":"lastChild"]:d[e?"endContainer":"startContainer"],l=new tinymce.dom.TreeWalker(i,t.getBody());i=l.current();){if(1==i.nodeType&&"SPAN"==i.nodeName&&null!==i.getAttribute("data-mce-index"))for(o=i.getAttribute("data-mce-index"),r=i.firstChild;i=l.current();){if(1==i.nodeType&&"SPAN"==i.nodeName&&null!==i.getAttribute("data-mce-index")){if(i.getAttribute("data-mce-index")!==o)return;a=i.firstChild}l[e?"next":"prev"]()}l[e?"next":"prev"]()}}(),r&&a&&(t.focus(),e?(d.setStart(r,0),d.setEnd(a,a.length)):(d.setStart(a,0),d.setEnd(r,r.length)),i.scrollIntoView(r.parentNode),i.setRng(d)),o}function i(e){e.parentNode.removeChild(e)}var d,o=this,l=-1;o.init=function(e){e.addMenuItem("searchreplace",{text:"Find and replace",shortcut:"Ctrl+F",onclick:n,separator:"before",context:"edit"}),e.addButton("searchreplace",{tooltip:"Find and replace",shortcut:"Ctrl+F",onclick:n}),e.shortcuts.add("Ctrl+F","",n)},o.markAllMatches=function(n){var r,a;return a=t.dom.create("span",{class:"mce-match-marker","data-mce-bogus":1}),r=t.getBody(),o.unmarkAllMatches(r),e(n,r,a,!1,t.schema)},o.first=function(){return-1!==(l=a(!0,!0))},o.next=function(){return-1!==(l=a(!0))},o.prev=function(){return-1!==(l=a(!1))},o.replace=function(e,n,d){var o,c,s,u,f,h;if(-1===l&&(l=a(n)),h=a(n),s=t.getBody(),c=tinymce.toArray(s.getElementsByTagName("span")),c.length)for(o=0;o<c.length;o++){var p=c[o].getAttribute("data-mce-index");if(null!==p&&p.length&&(u=f=c[o].getAttribute("data-mce-index"),d||u===l))for(e.length?(c[o].firstChild.nodeValue=e,r(c[o])):i(c[o]);c[++o];)if(u=c[o].getAttribute("data-mce-index"),null!==p&&p.length){if(u!==f){o--;break}i(c[o])}}return-1==h&&(h=a(n,!0)),l=h,d&&t.selection.setCursorLocation(t.getBody(),0),t.undoManager.add(),-1!==l},o.replaceAll=function(e){o.replace(e,!0,!0)},o.unmarkAllMatches=function(){var e,n,a;for(a=t.getBody(),n=a.getElementsByTagName("span"),e=n.length;e--;)a=n[e],a.getAttribute("data-mce-index")&&r(a)},t.on("beforeaddundo keydown",function(e){if(d)return e.preventDefault(),!1})}tinymce.PluginManager.add("searchreplace",t)}();